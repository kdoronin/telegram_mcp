# Telegram MCP Server

Сервер для работы с Telegram API через протокол MTProto. Предоставляет REST API для взаимодействия с Telegram.

## Требования

- Node.js 14+
- API ID и API Hash от Telegram

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd telegram-mcp
```

2. Установите зависимости:
```bash
npm install
```

3. Создайте и настройте файл `.env`:
```bash
# Скопируйте пример файла .env
cp .env.example .env
# Отредактируйте файл и укажите свои данные
```

4. Получите API ID и API Hash:
   - Перейдите на сайт [my.telegram.org](https://my.telegram.org)
   - Войдите в свой аккаунт
   - Перейдите в "API development tools"
   - Создайте новое приложение
   - Скопируйте API ID и API Hash в файл `.env`

## Запуск

Запустите сервер:
```bash
npm start
```

Для разработки с автоматической перезагрузкой:
```bash
npm run dev
```

## API Endpoints

### Статус сервера
```
GET /
```
Возвращает статус сервера.

### Выполнение любого метода Telegram API
```
POST /api/execute
```
Параметры (JSON):
- `session`: ID сессии (обычно номер телефона)
- `method`: Метод API Telegram
- `params`: Параметры метода (опционально)

### Получение списка чатов
```
GET /api/dialogs?session=PHONE_NUMBER&limit=100
```
Параметры (query):
- `session`: ID сессии (обычно номер телефона)
- `limit`: Максимальное количество чатов (опционально, по умолчанию 100)

### Получение сообщений из чата
```
GET /api/messages?session=PHONE_NUMBER&chatId=CHAT_ID&limit=100
```
Параметры (query):
- `session`: ID сессии (обычно номер телефона)
- `chatId`: ID чата или юзернейм
- `limit`: Максимальное количество сообщений (опционально, по умолчанию 100)

### Отправка сообщения
```
POST /api/send
```
Параметры (JSON):
- `session`: ID сессии (обычно номер телефона)
- `chatId`: ID чата или юзернейм
- `message`: Текст сообщения

### Получение списка доступных методов
```
GET /api/methods
```
Возвращает список доступных методов API с информацией о параметрах.

## Документация API

Сервер предоставляет полную документацию API в формате Swagger/OpenAPI:

```
GET /api-docs
```

Это интерактивная документация, которая позволяет изучать API и делать тестовые запросы. 

Также доступна JSON-спецификация OpenAPI:

```
GET /api-docs.json
```

Эту спецификацию можно использовать для автоматической генерации клиентов в различных языках программирования или для интеграции с внешними системами, включая AI-системы.

## Интеграция с Goose AI-агентом

Сервер поддерживает Model Context Protocol (MCP), что позволяет интегрировать его с [Goose AI-агентом](https://block.github.io/goose/).

### MCP Endpoints

```
GET /mcp/manifest
```
Возвращает манифест MCP, описывающий возможности сервера.

```
POST /mcp/execute
```
Выполняет функцию через MCP протокол.

### Пошаговая инструкция по добавлению в Goose

1. **Установка и настройка Telegram MCP-сервера**:
   - Установите и настройте Telegram MCP-сервер как описано выше
   - Убедитесь, что сервер запущен и доступен по адресу: `http://localhost:3000`

2. **Редактирование конфигурации Goose**:
   - Откройте файл конфигурации Goose (обычно `~/.config/goose/config.json`)
   - Добавьте новый MCP-сервер в раздел `mcps`:

   ```json
   "mcps": [
     ...,
     {
       "name": "telegram",
       "url": "http://localhost:3000/mcp"
     }
   ]
   ```

3. **Перезапуск Goose**:
   - Перезапустите Goose, чтобы он загрузил новую конфигурацию
   - В логах Goose должно появиться сообщение о подключении к Telegram MCP-серверу

4. **Использование в промпте**:
   - Теперь вы можете использовать возможности Telegram в промптах для Goose
   - Пример промпта:

   ```
   Пожалуйста, получи список моих последних чатов в Telegram и покажи 5 самых новых сообщений из первого чата.
   ```

5. **Первая авторизация**:
   - При первом использовании сессии Telegram MCP-сервер запросит код подтверждения в консоли
   - Введите код, полученный от Telegram, чтобы авторизовать сессию
   - После авторизации сессия будет сохранена и использована для последующих запросов

### Пример использования через Goose

Вот как Goose может использовать Telegram MCP-сервер в ответе на запрос пользователя:

```
Пользователь: "Отправь сообщение 'Привет от Goose!' моему другу @john_doe в Telegram"

Goose: "Я отправлю сообщение вашему другу. Подождите, пожалуйста..."

(Goose автоматически использует функцию sendMessage из Telegram MCP-сервера)

Goose: "Сообщение успешно отправлено @john_doe: 'Привет от Goose!'"
```

## Примеры использования

### Авторизация (первый запуск)
При первом запуске для сессии потребуется авторизация. Сервер запросит код подтверждения в консоли.

### Получение чатов
```bash
curl -X GET "http://localhost:3000/api/dialogs?session=+79001234567&limit=10"
```

### Отправка сообщения
```bash
curl -X POST "http://localhost:3000/api/send" \
  -H "Content-Type: application/json" \
  -d '{"session": "+79001234567", "chatId": "username", "message": "Hello, world!"}'
```

## Безопасность

- Сервер должен запускаться в доверенной среде
- API ID и API Hash не должны передаваться третьим лицам
- Сохраняйте файлы сессий в безопасном месте

## Лицензия

MIT 